"""
Generates update scripts to patch files
"""

import diff_match_patch
import os.path
import os

TEMPLATE = """
# GENERATED BY PATCHER.py
# Patches files {}
import diff_match_patch

patches = {}

for f in patches:
    with open(f[0], "r") as re:
        text = re.read()
    text, results = diff_match_patch.patch_apply(f[1], text)
    if not all(results):
        raise ValueError('''file differs to much from original''')
    with open(f[0], "w") as wi:
        wi.write(text)
    print("Updated " + f[0])
"""

TEMPLATE_WRITE = """
# GENERATED BY PATCHER.py
# Creates files {}

files = {}

for f, c in files:
    with open(f[0], "w") as wi:
        wi.write(c)
print("Create files")
"""

def create_template_write(file_array):
    """
    Create a write script for files created
    """

    home_dir = os.path.expanduser("~")
    files = []

    for f in file_array:
        p = os.path.join(home_dir, f)
        with open(p, "r") as g:
            files.append((f, repr(g.read())))

    files = repr(files)

    return TEMPLATE_WRITE.format(repr(file_array), files)
